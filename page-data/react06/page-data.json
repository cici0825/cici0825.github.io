{"componentChunkName":"component---src-templates-page-js","path":"/react06","result":{"data":{"markdownRemark":{"frontmatter":{"title":"React 實戰篇 - 部落格","date":"16 April 2020","path":"/react06","author":"WuFangCi","excerpt":"寫給自己看的筆記系列","tags":["React","useEffect","react-router","useHistory","useLocation","useContext","JWT"],"coverImage":null},"id":"a370c099-9761-5158-8147-815a41e888cb","html":"<h1>使用 #react-router</h1>\n<ul>\n<li>官方文件(<a href=\"https://reactrouter.com/web/guides/quick-start\">https://reactrouter.com/web/guides/quick-start</a>)</li>\n<li>在實作部落格中，因為我們會有未登入 以及 使用者登入後.. 等等導向不同的 URL ，所以在 react 中，我們可以使用 react-router 幫我們完成 用 javascript 接 瀏覽器提供的 history API，在前端管理URL，而非發送 request 到 sever。</li>\n</ul>\n<hr>\n<h1>實作 react-router</h1>\n<ul>\n<li>把 react-router import 進來\n<code class=\"language-text\">import { HashRouter as Router, Switch, Route } from &quot;react-router-dom&quot;;</code></li>\n<li>在 <code class=\"language-text\">Switch</code>(切換) 底下 當路徑的名稱符合這個 <code class=\"language-text\">router</code>(路由) 就 render 底下的 component</li>\n<li>-</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// App.js</span>\n<span class=\"token keyword\">import</span> styled <span class=\"token keyword\">from</span> <span class=\"token string\">\"styled-components\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> HashRouter <span class=\"token keyword\">as</span> Router<span class=\"token punctuation\">,</span> Switch<span class=\"token punctuation\">,</span> Route <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-router-dom\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useState<span class=\"token punctuation\">,</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AuthContext <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../../contexts\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getMe <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../../WebAPI\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> Root <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>div<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  padding-top: 150px;\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>AuthContext<span class=\"token punctuation\">.</span>Provider value<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> user<span class=\"token punctuation\">,</span> setUser <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Root<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>Router<span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>Header <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>Switch<span class=\"token operator\">></span>\n      <span class=\"token comment\">// \"exact\" 一定要是完全符合才算匹配到   </span>\n            <span class=\"token operator\">&lt;</span>Route exact path<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span><span class=\"token operator\">></span>\n             <span class=\"token operator\">=></span> <span class=\"token operator\">&lt;</span>HomePage <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Route<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>Route path<span class=\"token operator\">=</span><span class=\"token string\">\"/login\"</span><span class=\"token operator\">></span>\n            <span class=\"token operator\">=></span>  <span class=\"token operator\">&lt;</span>LoginPage <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Route<span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Switch<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Router<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Root<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>AuthContext<span class=\"token punctuation\">.</span>Provider<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>要 render 的 page 拉出來跟 component 同一層</li>\n</ul>\n<blockquote>\n<p><img src=\"%E6%88%AA%E5%9C%96%202020-12-22%20%E4%B8%8B%E5%8D%883.08.58.png\"></p>\n</blockquote>\n<ul>\n<li>記得把頁面 export 和 import 資源。</li>\n<li>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"></code></pre></div>\n</li>\n<li>\n<p>-\nimport HomePage from \"../../pages/HomePage\"\nimport LoginPage from \"../../pages/LoginPage\";\nimport Header from \"../Header\";</p>\n<hr>\n</li>\n</ul>\n<h1>切板外加整合 react router</h1>\n<ul>\n<li>\n<h1>Link</h1>\n<ul>\n<li>在 style.component  傳進 Link 此 component 可以連結到其他地方</li>\n</ul>\n</li>\n<li>\n<h1>to</h1>\n<ul>\n<li>component 傳進 to 屬性 ，導到指定的URL。</li>\n</ul>\n</li>\n<li>\n<h1>useLocation 拿到目前的路徑</h1>\n<ul>\n<li>useLocation().pathName 查看目前的路徑名稱</li>\n<li>利用判斷 pathName 來顯示  active</li>\n<li><code class=\"language-text\">&lt;Nav $active = {location.pathname === &quot;new-post&quot;} to=&quot;new-post&quot;&gt;</code></li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useContext <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> styled <span class=\"token keyword\">from</span> <span class=\"token string\">\"styled-components\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AuthContext <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../../contexts\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> setAuthToken <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../../utils\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Link<span class=\"token punctuation\">,</span> useLocation<span class=\"token punctuation\">,</span> useHistory <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-router-dom\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> HeaderContainer <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>div<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  height: 130px;\n  display: flex;\n  justify-content: space-around;\n  align-items: center;\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  border-bottom: 1px solid rgba(0, 0, 0, 0.2);\n  padding: 0px 20px;\n  background-color: white;\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> Brand <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>h2<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  margin-right: 1em;\n  padding: 7px 0;\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> NavBarList <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>div<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  display: flex;\n  align-items: center;\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> Nav <span class=\"token operator\">=</span> <span class=\"token function\">styled</span><span class=\"token punctuation\">(</span>Link<span class=\"token punctuation\">)</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  border: 1px solid rgba(0, 0, 0, 0.3);\n  border-radius: 7px;\n  padding: 8px 20px;\n  margin-right: 10px;\n  letter-spacing: 1px;\n  cursor: point;\n  text-decoration: none;\n  color: black;\n  line-height: 1.8em;\n  \n  // here active\n  \n  </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> props<span class=\"token punctuation\">.</span>$active <span class=\"token operator\">&amp;&amp;</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">   border: 1px solid rgba(0, 0, 0);</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n  &amp;:hover {\n    background-color: black;\n    color: white;\n    transition: 1s;\n    font-style: italic;\n  }\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> LeftContainer <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>div<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  display: flex;\n  align-items: center;\n  justify-content: space-around;\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> RightContainer <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>div<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Header</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">const</span> location <span class=\"token operator\">=</span> <span class=\"token function\">useLocation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> history <span class=\"token operator\">=</span> <span class=\"token function\">useHistory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>HeaderContainer<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>LeftContainer<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>Brand<span class=\"token operator\">></span>Articles<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Brand<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>NavBarList<span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>Nav $active<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>location<span class=\"token punctuation\">.</span>pathname <span class=\"token operator\">===</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">}</span> to<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span><span class=\"token operator\">></span>\n            Home\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Nav<span class=\"token operator\">></span>\n          <span class=\"token punctuation\">{</span>user <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\n            <span class=\"token operator\">&lt;</span>Nav $active<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>location<span class=\"token punctuation\">.</span>pathname <span class=\"token operator\">===</span> <span class=\"token string\">\"new-post\"</span><span class=\"token punctuation\">}</span> to<span class=\"token operator\">=</span><span class=\"token string\">\"new-post\"</span><span class=\"token operator\">></span>\n              Add\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Nav<span class=\"token operator\">></span>\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>NavBarList<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>LeftContainer<span class=\"token operator\">></span>\n\n      <span class=\"token operator\">&lt;</span>RightContainer<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>NavBarList<span class=\"token operator\">></span>\n          <span class=\"token punctuation\">{</span><span class=\"token operator\">!</span>user <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\n            <span class=\"token operator\">&lt;</span>Nav to<span class=\"token operator\">=</span><span class=\"token string\">\"/login\"</span> $active<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>location<span class=\"token punctuation\">.</span>pathname <span class=\"token operator\">===</span> <span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n              Login\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Nav<span class=\"token operator\">></span>\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">{</span>user <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">&lt;</span>Nav onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>handleLogout<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>Logout<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Nav<span class=\"token operator\">></span><span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>NavBarList<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>RightContainer<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>HeaderContainer<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<hr>\n<h1>實作文章列表頁面</h1>\n<p>API 資源：\n<a href=\"https://github.com/Lidemy/lidemy-student-json-api-server\">給 Lidemy 學生拿來練習串接 API 的 json server</a></p>\n<ul>\n<li>因為我們會接一些 API 用來顯示資料和傳送資料，所以這部分可以先抽出來，整理成一個 WebAPI 的檔案。</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// WebAPI.js</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getAuthToken <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./utils\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">BASE_URL</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"https://student-json-api.lidemy.me\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 讀取</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getPosts</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">BASE_URL</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/posts?_sort=createdAt&amp;_order=desc</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n   res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 登入</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">login</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">username<span class=\"token punctuation\">,</span> password</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">BASE_URL</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/login</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n   method<span class=\"token operator\">:</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">,</span>\n   headers<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token string\">\"content-type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">,</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n   body<span class=\"token operator\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n     username<span class=\"token punctuation\">,</span>\n     password<span class=\"token punctuation\">,</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getMe</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">const</span> token <span class=\"token operator\">=</span> <span class=\"token function\">getAuthToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">BASE_URL</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/me</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n   headers<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n     authorization<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Bearer </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>token<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>HomePage 顯示文章</h3>\n<ul>\n<li>\n<p>設定文章的狀態初始值</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>post<span class=\"token punctuation\">,</span>setPost<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>接API 因為是讀取資料，所以在瀏覽器 paint 畫面一開始發 request 就好，接到資料後，設定顯示文章。</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"> <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n   <span class=\"token function\">getPosts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">posts</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setPost</span><span class=\"token punctuation\">(</span>posts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>MAP 接到的資料</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n   <span class=\"token operator\">&lt;</span>Root<span class=\"token operator\">></span>\n     <span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">post</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n       <span class=\"token operator\">&lt;</span>Post post<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">}</span> key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n     <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n   <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Root<span class=\"token operator\">></span>\n <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>\n<p>用另外一個 post component 專門放 被會被 render 出來的 post 資訊</p>\n<ul>\n<li>記得把我們 set 的 post 傳進去</li>\n<li>對應相關的 component 傳入對應的資訊</li>\n<li>postTitle 在 style</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">Post</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> post <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>PostContainer<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>PostHeader<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>PostTitle to<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/post/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>post<span class=\"token punctuation\">.</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>PostTitle<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>PostDate<span class=\"token operator\">></span><span class=\"token punctuation\">{</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">.</span>createdAt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toLocaleString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>PostDate<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>PostHeader<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>PostContainer<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>完整程式碼</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> styled <span class=\"token keyword\">from</span> <span class=\"token string\">\"styled-components\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useState<span class=\"token punctuation\">,</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getPosts <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../../WebAPI\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> PropTypes <span class=\"token keyword\">from</span> <span class=\"token string\">\"prop-types\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Link <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-router-dom\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> Root <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>div<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n padding: 0 10px;\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> PostContainer <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>div<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n margin: 0 auto;\n max-width: 800px;\n border-bottom: 0.5px solid rgba(0, 0, 0, 0.05);\n padding: 10px;\n &amp;:hover {\n   transition: 0.5s;\n }\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> PostHeader <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>div<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n display: flex;\n align-items: center;\n justify-content: space-between;\n padding: 10px;\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> PostTitle <span class=\"token operator\">=</span> <span class=\"token function\">styled</span><span class=\"token punctuation\">(</span>Link<span class=\"token punctuation\">)</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n width: 60%;\n text-decoration: none;\n color: black;\n font-weight: bold;\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> PostDate <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>div<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n width: 20%;\n font-size: 12px;\n font-style: italic;\n letter-spacing: 0.5px;\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Post</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> post <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n   <span class=\"token operator\">&lt;</span>PostContainer<span class=\"token operator\">></span>\n     <span class=\"token operator\">&lt;</span>PostHeader<span class=\"token operator\">></span>\n       <span class=\"token operator\">&lt;</span>PostTitle to<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/post/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>post<span class=\"token punctuation\">.</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>PostTitle<span class=\"token operator\">></span>\n       <span class=\"token operator\">&lt;</span>PostDate<span class=\"token operator\">></span><span class=\"token punctuation\">{</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">.</span>createdAt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toLocaleString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>PostDate<span class=\"token operator\">></span>\n     <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>PostHeader<span class=\"token operator\">></span>\n   <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>PostContainer<span class=\"token operator\">></span>\n <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nPost<span class=\"token punctuation\">.</span>propTypes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n post<span class=\"token operator\">:</span> PropTypes<span class=\"token punctuation\">.</span>object<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">HomePage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>post<span class=\"token punctuation\">,</span> setPost<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n   <span class=\"token function\">getPosts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">posts</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setPost</span><span class=\"token punctuation\">(</span>posts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n   <span class=\"token operator\">&lt;</span>Root<span class=\"token operator\">></span>\n     <span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">post</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n       <span class=\"token operator\">&lt;</span>Post post<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">}</span> key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n     <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n   <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Root<span class=\"token operator\">></span>\n <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<hr>\n<h1>實作單一文章頁面</h1>\n<p>作業</p>\n<hr>\n<h1>實作登入功能</h1>\n<p> <a href=\"https://github.com/Lidemy/lidemy-student-json-api-server\">給 Lidemy 學生拿來練習串接 API 的 json server</a></p>\n<p> 以前帶 session 的方式 是在 sever 端 set-cookie response 把 session 放到 client 端 瀏覽器的 cookie 中。</p>\n<blockquote>\n<p><img src=\"%E6%88%AA%E5%9C%96%202020-12-23%20%E4%B8%8B%E5%8D%885.29.25.png\"></p>\n</blockquote>\n<hr>\n<p> SPA後較少用 cookie 做驗證，一樣是利用 session-ID，前端把 token 存在 local-storage 中，每當我們對 sever 送出 request ，這個 token 會自動被帶上。</p>\n<p>下圖\n當我們登入後，sever 會 response JSON Web Token ，一種固定的格式簡稱 JWT。\n驗證身份時，client header 要自帶 JWT，sever 確認沒問題後會回傳 response</p>\n<blockquote>\n<p><img src=\"%E6%88%AA%E5%9C%96%202020-12-23%20%E4%B8%8B%E5%8D%885.35.02.png\"></p>\n</blockquote>\n<h5>串接登入的API</h5>\n<blockquote>\n<p><img src=\"%E6%88%AA%E5%9C%96%202020-12-23%20%E4%B8%8B%E5%8D%886.01.54.png\"></p>\n</blockquote>\n<h5>實作登入頁面</h5>\n<ul>\n<li>==<strong>監聽表單</strong>==  用表單事件送出資訊在表單掛上 on Submit ={handle-Function}</li>\n<li>==<strong>拿到輸入</strong>== 拿到輸入的 username/password value ， state。</li>\n<li>\n<p>-</p>\n<blockquote>\n<p><img src=\"%E6%88%AA%E5%9C%96%202020-12-23%20%E4%B8%8B%E5%8D%886.09.44.png\"></p>\n</blockquote>\n</li>\n<li>\n<p>在 react 中如果 value 等於 undefined 的話代表沒有傳，所以如果是字串的 state 要在 <code class=\"language-text\">use State(&#39;&#39;)</code>放空字串，react 在 hooks value 才會知道是 control component。</p>\n<ul>\n<li><img src=\"%E6%88%AA%E5%9C%96%202020-12-23%20%E4%B8%8B%E5%8D%886.48.50.png\"></li>\n</ul>\n</li>\n<li>==<strong>串登入API</strong>== import login API 後，console.log 看有沒有接收到 data。</li>\n</ul>\n<blockquote>\n<p><img src=\"%E6%88%AA%E5%9C%96%202020-12-23%20%E4%B8%8B%E5%8D%886.17.01.png\"></p>\n</blockquote>\n<ul>\n<li>response 回傳登入成功</li>\n</ul>\n<blockquote>\n<p><img src=\"%E6%88%AA%E5%9C%96%202020-12-23%20%E4%B8%8B%E5%8D%886.19.55.png\"></p>\n</blockquote>\n<ul>\n<li>==<strong>設置Error</strong>==  用 err state 前端顯示錯誤回報</li>\n</ul>\n<blockquote>\n<p><img src=\"%E6%88%AA%E5%9C%96%202020-12-23%20%E4%B8%8B%E5%8D%886.21.40.png\">\n給他錯誤的 component 傳進 state\n<img src=\"%E6%88%AA%E5%9C%96%202020-12-23%20%E4%B8%8B%E5%8D%886.23.50.png\"></p>\n</blockquote>\n<ul>\n<li>==<strong>拿 token</strong>==，存到 local Storage</li>\n</ul>\n<blockquote>\n<p><img src=\"%E6%88%AA%E5%9C%96%202020-12-23%20%E4%B8%8B%E5%8D%886.54.27.png\"></p>\n</blockquote>\n<p><strong>優化一下 localStorage 的 code</strong></p>\n<ul>\n<li>我們在 WebAPI 和 Login 都用到 local Storage 拿與存取，因此我們可以把他整合在工具型的檔案中。</li>\n<li>\n<blockquote>\n<p><img src=\"%E6%88%AA%E5%9C%96%202020-12-24%20%E4%B8%8A%E5%8D%8811.06.06.png\"></p>\n</blockquote>\n</li>\n<li>\n<p>把我們寫完的 setAuthToken( login) 和 getAuthToken( webAPI getMe ) import 到檔案內後替代原本的寫法。</p>\n<ul>\n<li>\n<blockquote>\n<p><img src=\"%E6%88%AA%E5%9C%96%202020-12-24%20%E4%B8%8A%E5%8D%8811.08.53.png\"></p>\n</blockquote>\n</li>\n<li>\n<blockquote>\n<p><img src=\"%E6%88%AA%E5%9C%96%202020-12-24%20%E4%B8%8A%E5%8D%8811.12.50.png\"></p>\n</blockquote>\n</li>\n</ul>\n</li>\n<li>\n<p>==<strong>登入成功後導回首頁</strong>==</p>\n<ul>\n<li>使用 <code class=\"language-text\">useHistory()</code> hook 導回首頁 <a href=\"https://reactrouter.com/web/api/Hooks/usehistory\">useHistory 文件示範</a></li>\n<li>import useHistory() hook</li>\n<li><code class=\"language-text\">const history = useHistory();</code></li>\n<li><code class=\"language-text\">history.push(&quot;/&quot;) 導回目錄</code></li>\n<li>\n<blockquote>\n<p><img src=\"%E6%88%AA%E5%9C%96%202020-12-24%20%E4%B8%8A%E5%8D%8811.23.26.png\"></p>\n</blockquote>\n<h6>回到首頁後我們雖然登入了，但需要存取 user 狀態，我們需要把這個狀態存到所有 component 都能存取的地方</h6>\n</li>\n</ul>\n</li>\n</ul>","excerpt":"使用 #react-router 官方文件(https://reactrouter.com/web/guides/quick-start) 在實作部落格中，因為我們會有未登入 以及 使用者登入後.. 等等導向不同的 URL ，所以在 react 中，我們可以使用 react…"}},"pageContext":{"type":"posts","next":null,"previous":{"frontmatter":{"path":"/react05","title":"React 實戰篇 - 留言板","tags":["React","useEffect","useLayoutEffect","week21","VirtualDOM","useCallback","memo"]},"fileAbsolutePath":"/Users/fangciwu/gatsby/gatsby-starter-hello-friend/src/posts/react05.md"}}},"staticQueryHashes":["1425477374","3128451518"]}